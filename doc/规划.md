# 规划

## 目标

实现鼠标操作多层方块

## 功能细分

- 基元: 方块, 正方形, 线段, 点
- 基元渲染
  - 常规基元的渲染与优化
  - 水的渲染 特殊基元的渲染
  - 视锥剔除
- 玩家移动, 自动加载卸载基元
  - 数据
  - 渲染
- 基元运行时数据存储
  - 不变数据链接(`Chunk`+`id`)
  - 持久状态(如方块的朝向), 达到类似支持参数的静态数据的效果.
  - 短期状态(如血量)
- 基元原型(反)序列化.
  - 不变数据
  - 持久状态规则
  - mod 支持
- 鼠标点击 射线检测
- 控制相机移动 连续移动, 离散位置
- 基元操作接口
  - 坐标查询基元
    - 局部
    - 全局
  - 增删基元
  - 基元切分与合并
    - 超大基元, 切出一个小基元.
- 物体操作接口
  - 坐标查询
  - 绑定基元成为新物体
  - 删物体
  - 对物体绑定解绑基元
- 物体的行为
  - 瞬时行为: 必须尽快(几帧之内, 玩家无延迟感)执行完成. 如打开开关, 灯亮, 其中电沿着电线传导就是瞬时行为.
  - 耗时行为: 大量计算, 希望尽快完成, 但无法立刻执行完成(玩家也知道这点), 计算时对外界无影响, 只有在完成时才影响外界. 如玩家自己制作了一个电脑, 在里面进行复杂计算.
  - 持续行为: 在一定时间内, 持续影响外界. 如自制电脑发热.
  - 定时行为: 无繁重计算, 但是是在一段时间后才发生, 可以看成未来的瞬时行为. 如植物生长.
- LOD
  - 渲染
    - 物体与基元大小同时影响 LOD
    - 物体的多级替代物体(就是一般的 LOD 概念, 只不过模型都是基元构成的)
  - 逻辑
- 地形生成 大概即可
- 地图保存

## 代码结构



## 规划

进度说明:

1. 无: 未开始. 可以省略不写
1. 设: 设计阶段.
1. 接: 写了接口. 方便其他模块先写.
1. 进: 进行中.
1. 测: 在写简单的测试代码.
1. 用: 初步写完, 并写完简单的测试. 等待其他功能使用, 检查问题, 并作出修改.
1. 完: 经过至少一个其他模块使用后, 可以算是完成.
1. 旧: 之前写好的, 不知道这里能不能用, 应该还需要改

| 功能      | 预期时间 | 进度 | 实际耗时 | 简介                                                             |
| --------- | -------- | ---- | -------- | ---------------------------------------------------------------- |
| `BigIng`  |          |      |          | 固定大小的大整数, 192bit 或 256bit 就够用了                      |
| `Coord`   |          | 旧   |          | 整数坐标. 分为全局和局部两种, 操作相同, 只有里面数据类型不同     |
| `Orient`  |          | 旧   |          | 表是整 90 度旋转. 方向相关也在这里.                              |
| `Chunk`   |          |      |          | 3d 数组. 外部透明, 是`Storage`的连续存储.                        |
| `Storage` |          |      |          | 用来存各种方块数据的通用数据结构, 稀疏与连续混合的存储方式.      |
| `World`   |          |      |          | 游戏世界内可修改的数据. 放各种`Storage`的地方.                   |
| `Context` |          |      |          | 主菜单可修改, 游戏世界内不可修改(只读). 如:mod 相关, `form`表等. |
| `Config`  |          |      |          | 主菜单也无法立刻修改, 需要重启游戏. 一些静态的数据.              |
|           |          |      |          |                                                                  |
|           |          |      |          |                                                                  |
|           |          |      |          |                                                                  |
|           |          |      |          |                                                                  |
